FROM node:lts-alpine as build-stage

ENV WORKDIR=/code
WORKDIR $WORKDIR

# copy both 'package.json' and 'package-lock.json' (if available)
COPY app/frontend/package*.json $WORKDIR/

# install project dependencies
RUN npm install --legacy-peer-deps

COPY app/frontend $WORKDIR

RUN npm run build

# Serve Vue
FROM nginx:alpine as production-stage

RUN mkdir $WORKDIR
COPY app/nginx/nginx.conf /etc/nginx/conf.d/default.conf
COPY --from=build-stage $WORKDIR/dist $WORKDIR

EXPOSE 8080